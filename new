
Nisha	Please give me a summary of this providers recent prescribing trends (Journavx and other pain products), have they had any recent abandoned prescriptions, what managed care plans will they have the least friction with, what procedures would be the most
 meaningful to describe acute moderate to severe pain patients for this provider, what pharmacies do most of their patients go to?	Performance/Targeting	 	XPO, LAAD Rx Claims, MMIT Coverage, LAAD Procedural Claims, Sales Alignment	 	 	 	 	 	 	 	 	 	 	 	 	 
Nisha	Vertex internal question: Where can I find open AOC reports? Can you pull up sample delivery orders that have been returned?	Sampling	 	 	 	 	 	 	 	 	 	 	 	 	 	 	 
Nisha	Who are the top opioid prescribers in Geisinger Community Medical Center?	Targeting	 	Veeva CRM Affiliations, LAAD Claims	 	 	 	 	 	 	 	 	 	 	 	 	 
Nisha	Show me the top 5 orthopedic shoulder surgeons in Allentown Pa?	Targeting	 	LAAD, IQVIA OneKey	 	 	 	 	 	 	 	 	 	 	 	 	 
Nisha	Who are my top prescribers prescribing Norco sorted by city, address, and parent account	Targeting	 	Veeva CRM Affiliations, Current Sales Alignment, LAAD Claims, Veeva CRM Primary Address	 	 	 	 	 	 	 	 	 	 	 	 	 
Rakesh	Who are my top prescribers prescribing Tramadol sorted by city, address, and parent account	Targeting	 	Veeva CRM Affiliations, Current Sales Alignment, LAAD Claims, Veeva CRM Primary Address	 	 	 	 	 	 	 	 	 	 	 	 	 
Rakesh	Provide me a list of top prescribers for all opioids sorted by city and address and parent account	Targeting	 	Veeva CRM Affiliations, Current Sales Alignment, LAAD Claims, Veeva CRM Primary Address	 	 	 	 	 	 	 	 	 	 	 	 	 
Rakesh	Based on prescribing habits, leads data, AI generated leads dashboard, build me a routing for Town X.  Sort these providers first by Journavx Rx over the past 4 weeks.  	Targeting	 	NBX Data, Veeva CRM Address, XPO JVX Rx	 	 	 	 	 	 	 	 	 	 	 	 	 
Rakesh	Based on a combination of procedure volume and prescribing habits provide me a list of HCP with high volume Opioid use and a list of low volume opioid use.  	Targeting	 	Veeva CRM Affiliations, Current Sales Alignment, LAAD Procedure Claims	 	 	 	 	 	 	 	 	 	 	 	 	 
Rakesh	Which zip codes should we focus on to capitalize on positive payer access?	Targeting	 	Targeting Hub Payer Data, MMIT Payer Wins Data, Veeva CRM Address Data, LAAD Rx Claims	 	 	 	 	 	 	 	 	 	 	 	 	 
Sandeep	Which high potential zip codes have the least amount of activity?	Targeting	 	Veeva CRM Address data, Engagement Data	 	 	 	 	 	 	 	 	 	 	 	 	 
Sandeep	I am going into this practice that has 10 providers,  based on all available data, which provider is the most likely to be an early adopter of Journavx (same concept for an hospital department/system)?	Targeting	 	Adopter model, Veeva CRM Affilitions, Alignment	 	 	 	 	 	 	 	 	 	 	 	 	 
Sandeep	Who are the first-time prescribers that I need to follow up with this week?	Targeting	 	XPO, NBX, Sales Alignment	 	 	 	 	 	 	 	 	 	 	 	 	 
Sandeep	Which adopters have not written within the last 2 weeks that I should follow up with?	Targeting	 	XPO, Sales Alignment	 	 	 	 	 	 	 	 	 	 	 	 	 
Sandeep	What high volume prescribers have I not seen within the last month?	Targeting	 	XPO, Sales Alignment, Veeva CRM Engagement	 	 	 	 	 	 	 	 	 	 	 	 	 
 Consolidated List of Unique Tables for Sandeep
Adopter model

Alignment / Sales Alignment

Engagement Data / Veeva CRM Engagement

NBX

Veeva CRM Address data

Veeva CRM Affiliations

XPO
 


Table Name
TXR_VRTX_MCO_PAYER_CAT_2_PLAN
TD_MM_PAYER_CATEGORY_L3 
TD_MM_PAYER_CATEGORY_L2 
TD_VRTX_MCO_PAYER
TD_VRTX_MCO_PLAN
How to Get Payer Channel L2 with HCP and Payer

TM_NRAF_L1_SOC_OTLT_DC_NDC_WK
TM_NRAF_L1_SOC_OTLT_DC_NDC_MTH
TM_RX_L1_HCPPLNDC_NDC_WK
TM_RX_L1_HCPPLNDC_NDC_MTH
TM_NRAFIC_L1_OTLT_SOC_DC_NDC_WK

TD_GEO_LOC
TXR_HCP_GEOLOC_PRIM
TD_SALESFORCE_L1
TD_DATA_LOAD. CURR_IC_SF_ALN_KEY
TXR_HCP_SF_L1

TD_OTLT_SUBCAT
TXR_OTLT_SUBCAT

TD_TIME_DT

TXR_MKTGPGM_GHEM_HCO_SUBTYPE
TXR_MKTGPGM_CURR_PTAM_HCP_TGT
TXR_MKTGPGM_CURR_SAL_IDN_TGT
TXR_MKTGPGM_SUZ_HCP_SEGMENT
TXR_MKTGPGM_PAIN_SOC_TGT

TD_IDN
TD_SOC
TD_HCP
TXR_SOC_IDN
TXR_HCP_SOC
TD_SPECGRP
TXR_HCP_SPEC
TD_HCP.HCP_SRC_ID_P_SCRUB

TXR_NTILE_HCP_SUZ_QTRLY_STATIC_R52W 
TXR_NTILE_HCP_ANYPAIN_R52W
TXR_NTILE_HCP_SUZ_R52W

SELECT 
    TABLE_CATALOG as DATABASE_NAME,
    TABLE_SCHEMA as SCHEMA_NAME,
    TABLE_NAME,
    -- This column generates the code you need to copy/paste:
    'SELECT GET_DDL(\'TABLE\', \'' || TABLE_CATALOG || '.' || TABLE_SCHEMA || '.' || TABLE_NAME || '\');' as COPY_THIS_COMMAND
FROM 
    INFORMATION_SCHEMA.TABLES
WHERE 
    TABLE_NAME IN (
        'TXR_VRTX_MCO_PAYER_CAT_2_PLAN',
        'TD_MM_PAYER_CATEGORY_L3',
        'TD_MM_PAYER_CATEGORY_L2',
        'TD_VRTX_MCO_PAYER',
        'TD_VRTX_MCO_PLAN',
        'TM_NRAF_L1_SOC_OTLT_DC_NDC_WK',
        'TM_NRAF_L1_SOC_OTLT_DC_NDC_MTH',
        'TM_RX_L1_HCPPLNDC_NDC_WK',
        'TM_RX_L1_HCPPLNDC_NDC_MTH',
        'TM_NRAFIC_L1_OTLT_SOC_DC_NDC_WK',
        'TD_GEO_LOC',
        'TXR_HCP_GEOLOC_PRIM',
        'TD_SALESFORCE_L1',
        'TD_DATA_LOAD',
        'TXR_HCP_SF_L1',
        'TD_OTLT_SUBCAT',
        'TXR_OTLT_SUBCAT',
        'TD_TIME_DT',
        'TXR_MKTGPGM_GHEM_HCO_SUBTYPE',
        'TXR_MKTGPGM_CURR_PTAM_HCP_TGT',
        'TXR_MKTGPGM_CURR_SAL_IDN_TGT',
        'TXR_MKTGPGM_SUZ_HCP_SEGMENT',
        'TXR_MKTGPGM_PAIN_SOC_TGT',
        'TD_IDN',
        'TD_SOC',
        'TD_HCP',
        'TXR_SOC_IDN',
        'TXR_HCP_SOC',
        'TD_SPECGRP',
        'TXR_HCP_SPEC',
        'TXR_NTILE_HCP_SUZ_QTRLY_STATIC_R52W',
        'TXR_NTILE_HCP_ANYPAIN_R52W',
        'TXR_NTILE_HCP_SUZ_R52W'
    );

SELECT 
    TABLE_CATALOG AS DB_NAME,
    TABLE_SCHEMA AS SCHEMA_NAME,
    TABLE_NAME,
    -- This generates the exact code you need to copy and paste
    'SELECT GET_DDL(\'TABLE\', \'' || TABLE_CATALOG || '.' || TABLE_SCHEMA || '.' || TABLE_NAME || '\');' AS RUN_TO_GET_DDL
FROM 
    SNOWFLAKE.ACCOUNT_USAGE.TABLES
WHERE 
    DELETED IS NULL  -- Excludes deleted tables
    AND TABLE_NAME IN (
        'TXR_VRTX_MCO_PAYER_CAT_2_PLAN',
        'TD_MM_PAYER_CATEGORY_L3',
        'TD_MM_PAYER_CATEGORY_L2',
        'TD_VRTX_MCO_PAYER',
        'TD_VRTX_MCO_PLAN',
        'TM_NRAF_L1_SOC_OTLT_DC_NDC_WK',
        'TM_NRAF_L1_SOC_OTLT_DC_NDC_MTH',
        'TM_RX_L1_HCPPLNDC_NDC_WK',
        'TM_RX_L1_HCPPLNDC_NDC_MTH',
        'TM_NRAFIC_L1_OTLT_SOC_DC_NDC_WK',
        'TD_GEO_LOC',
        'TXR_HCP_GEOLOC_PRIM',
        'TD_SALESFORCE_L1',
        'TD_DATA_LOAD',
        'TXR_HCP_SF_L1',
        'TD_OTLT_SUBCAT',
        'TXR_OTLT_SUBCAT',
        'TD_TIME_DT',
        'TXR_MKTGPGM_GHEM_HCO_SUBTYPE',
        'TXR_MKTGPGM_CURR_PTAM_HCP_TGT',
        'TXR_MKTGPGM_CURR_SAL_IDN_TGT',
        'TXR_MKTGPGM_SUZ_HCP_SEGMENT',
        'TXR_MKTGPGM_PAIN_SOC_TGT',
        'TD_IDN',
        'TD_SOC',
        'TD_HCP',
        'TXR_SOC_IDN',
        'TXR_HCP_SOC',
        'TD_SPECGRP',
        'TXR_HCP_SPEC',
        'TXR_NTILE_HCP_SUZ_QTRLY_STATIC_R52W',
        'TXR_NTILE_HCP_ANYPAIN_R52W',
        'TXR_NTILE_HCP_SUZ_R52W'
    )
ORDER BY 
    TABLE_NAME;
SHOW TABLES LIKE 'TXR_VRTX_MCO_PAYER_CAT_2_PLAN' IN ACCOUNT;
-- 1. Create a container for the results
CREATE OR REPLACE TEMPORARY TABLE FINAL_DDL_OUTPUT (
    TABLE_NAME VARCHAR, 
    DATABASE_PATH VARCHAR,
    DDL_DEFINITION VARCHAR
);

-- 2. Execute the Search and Extraction Logic
EXECUTE IMMEDIATE $$
DECLARE
    -- Variables for processing
    db_name VARCHAR;
    sch_name VARCHAR;
    tbl_name VARCHAR;
    full_path VARCHAR;
    get_ddl_cmd VARCHAR;
    ddl_result VARCHAR;
    
    -- Cursor to iterate through the found tables
    -- We first run SHOW TABLES to find locations, then filter for your specific list
    c1 CURSOR FOR 
        SELECT "database_name", "schema_name", "name"
        FROM TABLE(RESULT_SCAN(LAST_QUERY_ID()))
        WHERE "name" IN (
            'TXR_VRTX_MCO_PAYER_CAT_2_PLAN',
            'TD_MM_PAYER_CATEGORY_L3',
            'TD_MM_PAYER_CATEGORY_L2',
            'TD_VRTX_MCO_PAYER',
            'TD_VRTX_MCO_PLAN',
            'TM_NRAF_L1_SOC_OTLT_DC_NDC_WK',
            'TM_NRAF_L1_SOC_OTLT_DC_NDC_MTH',
            'TM_RX_L1_HCPPLNDC_NDC_WK',
            'TM_RX_L1_HCPPLNDC_NDC_MTH',
            'TM_NRAFIC_L1_OTLT_SOC_DC_NDC_WK',
            'TD_GEO_LOC',
            'TXR_HCP_GEOLOC_PRIM',
            'TD_SALESFORCE_L1',
            'TD_DATA_LOAD',
            'TXR_HCP_SF_L1',
            'TD_OTLT_SUBCAT',
            'TXR_OTLT_SUBCAT',
            'TD_TIME_DT',
            'TXR_MKTGPGM_GHEM_HCO_SUBTYPE',
            'TXR_MKTGPGM_CURR_PTAM_HCP_TGT',
            'TXR_MKTGPGM_CURR_SAL_IDN_TGT',
            'TXR_MKTGPGM_SUZ_HCP_SEGMENT',
            'TXR_MKTGPGM_PAIN_SOC_TGT',
            'TD_IDN',
            'TD_SOC',
            'TD_HCP',
            'TXR_SOC_IDN',
            'TXR_HCP_SOC',
            'TD_SPECGRP',
            'TXR_HCP_SPEC',
            'TXR_NTILE_HCP_SUZ_QTRLY_STATIC_R52W',
            'TXR_NTILE_HCP_ANYPAIN_R52W',
            'TXR_NTILE_HCP_SUZ_R52W'
        );

BEGIN
    -- A. Run a broad search (Since your tables start with T, we use 'T%')
    SHOW TABLES LIKE 'T%' IN ACCOUNT;

    -- B. Open the cursor to process the filtered results from the search above
    OPEN c1;
    
    FOR rec IN c1 DO
        db_name := rec."database_name";
        sch_name := rec."schema_name";
        tbl_name := rec."name";
        full_path := db_name || '.' || sch_name || '.' || tbl_name;
        
        -- C. Construct the GET_DDL command dynamically
        get_ddl_cmd := 'SELECT GET_DDL(''TABLE'', ''' || full_path || ''')';
        
        -- D. Run GET_DDL and capture the text
        EXECUTE IMMEDIATE get_ddl_cmd INTO :ddl_result;
        
        -- E. Save to our output table
        INSERT INTO FINAL_DDL_OUTPUT (TABLE_NAME, DATABASE_PATH, DDL_DEFINITION) 
        VALUES (:tbl_name, :full_path, :ddl_result);
        
    END FOR;
    
    CLOSE c1;
    RETURN 'DDL Generation Complete. Check FINAL_DDL_OUTPUT table.';
END;
$$;

-- 3. View the final results
SELECT * FROM FINAL_DDL_OUTPUT ORDER BY TABLE_NAME;



-- Create a new database for admin tasks
CREATE DATABASE IF NOT EXISTS ADHOC_ADMIN_DB;

-- Create a schema specifically for this extraction
CREATE SCHEMA IF NOT EXISTS ADHOC_ADMIN_DB.METADATA_EXTRACT;

-- Set your context to this new location
USE SCHEMA ADHOC_ADMIN_DB.METADATA_EXTRACT;

-- 1. Create a container for the results
CREATE OR REPLACE TEMPORARY TABLE FINAL_DDL_OUTPUT (
    TABLE_NAME VARCHAR, 
    DATABASE_PATH VARCHAR,
    DDL_DEFINITION VARCHAR
);

-- 2. Execute the Search and Extraction Logic
EXECUTE IMMEDIATE $$
DECLARE
    -- Variables for processing
    db_name VARCHAR;
    sch_name VARCHAR;
    tbl_name VARCHAR;
    full_path VARCHAR;
    get_ddl_cmd VARCHAR;
    ddl_result VARCHAR;
    
    -- Cursor to iterate through the found tables
    -- We first run SHOW TABLES to find locations, then filter for your specific list
    c1 CURSOR FOR 
        SELECT database_name, schema_name, name
        FROM TABLE(RESULT_SCAN(LAST_QUERY_ID()));
        WHERE "name" IN (
            'TXR_VRTX_MCO_PAYER_CAT_2_PLAN',
            'TD_MM_PAYER_CATEGORY_L3',
            'TD_MM_PAYER_CATEGORY_L2',
            'TD_VRTX_MCO_PAYER',
            'TD_VRTX_MCO_PLAN',
            'TM_NRAF_L1_SOC_OTLT_DC_NDC_WK',
            'TM_NRAF_L1_SOC_OTLT_DC_NDC_MTH',
            'TM_RX_L1_HCPPLNDC_NDC_WK',
            'TM_RX_L1_HCPPLNDC_NDC_MTH',
            'TM_NRAFIC_L1_OTLT_SOC_DC_NDC_WK',
            'TD_GEO_LOC',
            'TXR_HCP_GEOLOC_PRIM',
            'TD_SALESFORCE_L1',
            'TD_DATA_LOAD',
            'TXR_HCP_SF_L1',
            'TD_OTLT_SUBCAT',
            'TXR_OTLT_SUBCAT',
            'TD_TIME_DT',
            'TXR_MKTGPGM_GHEM_HCO_SUBTYPE',
            'TXR_MKTGPGM_CURR_PTAM_HCP_TGT',
            'TXR_MKTGPGM_CURR_SAL_IDN_TGT',
            'TXR_MKTGPGM_SUZ_HCP_SEGMENT',
            'TXR_MKTGPGM_PAIN_SOC_TGT',
            'TD_IDN',
            'TD_SOC',
            'TD_HCP',
            'TXR_SOC_IDN',
            'TXR_HCP_SOC',
            'TD_SPECGRP',
            'TXR_HCP_SPEC',
            'TXR_NTILE_HCP_SUZ_QTRLY_STATIC_R52W',
            'TXR_NTILE_HCP_ANYPAIN_R52W',
            'TXR_NTILE_HCP_SUZ_R52W'
        );

BEGIN
    -- A. Run a broad search (Since your tables start with T, we use 'T%')
    SHOW TABLES LIKE 'T%' IN ACCOUNT;

    -- B. Open the cursor to process the filtered results from the search above
    OPEN c1;
    
    FOR rec IN c1 DO
        db_name := rec."database_name";
        sch_name := rec."schema_name";
        tbl_name := rec."name";
        full_path := db_name || '.' || sch_name || '.' || tbl_name;
        
        -- C. Construct the GET_DDL command dynamically
        get_ddl_cmd := 'SELECT GET_DDL(''TABLE'', ''' || full_path || ''')';
        
        -- D. Run GET_DDL and capture the text
        EXECUTE IMMEDIATE get_ddl_cmd INTO :ddl_result;
        
        -- E. Save to our output table
        INSERT INTO FINAL_DDL_OUTPUT (TABLE_NAME, DATABASE_PATH, DDL_DEFINITION) 
        VALUES (:tbl_name, :full_path, :ddl_result);
        
    END FOR;
    
    CLOSE c1;
    RETURN 'DDL Generation Complete. Check FINAL_DDL_OUTPUT table.';
END;
$$;

-- 3. View the final results
SELECT * FROM FINAL_DDL_OUTPUT ORDER BY TABLE_NAME;
-- 1. Search the whole account
SHOW TABLES LIKE 'T%' IN ACCOUNT;

-- 2. Save the results into a temporary table immediately
CREATE OR REPLACE TEMPORARY TABLE TBL_LOCATIONS AS 
SELECT 
    "database_name" AS DB_NAME, 
    "schema_name" AS SCH_NAME, 
    "name" AS TBL_NAME
FROM 
    TABLE(RESULT_SCAN(LAST_QUERY_ID()))
WHERE 
    "name" IN (
        'TXR_VRTX_MCO_PAYER_CAT_2_PLAN', 'TD_MM_PAYER_CATEGORY_L3', 'TD_MM_PAYER_CATEGORY_L2',
        'TD_VRTX_MCO_PAYER', 'TD_VRTX_MCO_PLAN', 'TM_NRAF_L1_SOC_OTLT_DC_NDC_WK',
        'TM_NRAF_L1_SOC_OTLT_DC_NDC_MTH', 'TM_RX_L1_HCPPLNDC_NDC_WK', 'TM_RX_L1_HCPPLNDC_NDC_MTH',
        'TM_NRAFIC_L1_OTLT_SOC_DC_NDC_WK', 'TD_GEO_LOC', 'TXR_HCP_GEOLOC_PRIM',
        'TD_SALESFORCE_L1', 'TD_DATA_LOAD', 'TXR_HCP_SF_L1', 'TD_OTLT_SUBCAT',
        'TXR_OTLT_SUBCAT', 'TD_TIME_DT', 'TXR_MKTGPGM_GHEM_HCO_SUBTYPE',
        'TXR_MKTGPGM_CURR_PTAM_HCP_TGT', 'TXR_MKTGPGM_CURR_SAL_IDN_TGT', 'TXR_MKTGPGM_SUZ_HCP_SEGMENT',
        'TXR_MKTGPGM_PAIN_SOC_TGT', 'TD_IDN', 'TD_SOC', 'TD_HCP', 'TXR_SOC_IDN',
        'TXR_HCP_SOC', 'TD_SPECGRP', 'TXR_HCP_SPEC', 'TXR_NTILE_HCP_SUZ_QTRLY_STATIC_R52W',
        'TXR_NTILE_HCP_ANYPAIN_R52W', 'TXR_NTILE_HCP_SUZ_R52W'
    );
-- Create the table to hold the final definitions
CREATE OR REPLACE TEMPORARY TABLE FINAL_DDL_OUTPUT (
    TABLE_NAME VARCHAR, 
    FULL_PATH VARCHAR,
    DDL_TEXT VARCHAR
);

-- Run the logic to fetch DDLs
EXECUTE IMMEDIATE $$
DECLARE
    db VARCHAR;
    sch VARCHAR;
    tbl VARCHAR;
    path VARCHAR;
    ddl_cmd VARCHAR;
    ddl_out VARCHAR;
    
    -- Iterate over the table we created in Step 2
    c1 CURSOR FOR SELECT DB_NAME, SCH_NAME, TBL_NAME FROM TBL_LOCATIONS;
BEGIN
    OPEN c1;
    FOR rec IN c1 DO
        db := rec.DB_NAME;
        sch := rec.SCH_NAME;
        tbl := rec.TBL_NAME;
        path := '"' || db || '"."' || sch || '"."' || tbl || '"';
        
        -- Build the GET_DDL command
        ddl_cmd := 'SELECT GET_DDL(\'TABLE\', \'' || path || '\')';
        
        BEGIN
            -- Try to run GET_DDL
            EXECUTE IMMEDIATE ddl_cmd INTO :ddl_out;
            
            -- Insert success
            INSERT INTO FINAL_DDL_OUTPUT (TABLE_NAME, FULL_PATH, DDL_TEXT) 
            VALUES (:tbl, :path, :ddl_out);
        EXCEPTION
            WHEN OTHER THEN
                -- If permission denied or table locked, log the error
                INSERT INTO FINAL_DDL_OUTPUT (TABLE_NAME, FULL_PATH, DDL_TEXT) 
                VALUES (:tbl, :path, 'ERROR: Could not retrieve DDL. Check permissions.');
        END;
    END FOR;
    CLOSE c1;
    RETURN 'Done.';
END;
$$;

-- View the results
SELECT * FROM FINAL_DDL_OUTPUT ORDER BY TABLE_NAME;


-- STEP 1: Setup the tables (Run this to ensure clean start)
CREATE OR REPLACE TEMPORARY TABLE FINAL_DDL_OUTPUT (
    TABLE_NAME VARCHAR, 
    FULL_PATH VARCHAR, 
    DDL_TEXT VARCHAR
);

CREATE OR REPLACE TEMPORARY TABLE TBL_LOCATIONS (
    DB_NAME VARCHAR, 
    SCH_NAME VARCHAR, 
    TBL_NAME VARCHAR
);

-- STEP 2: Find the tables and save their locations
SHOW TABLES LIKE 'T%' IN ACCOUNT;

INSERT INTO TBL_LOCATIONS 
SELECT "database_name", "schema_name", "name"
FROM TABLE(RESULT_SCAN(LAST_QUERY_ID()))
WHERE "name" IN (
    'TXR_VRTX_MCO_PAYER_CAT_2_PLAN', 'TD_MM_PAYER_CATEGORY_L3', 'TD_MM_PAYER_CATEGORY_L2',
    'TD_VRTX_MCO_PAYER', 'TD_VRTX_MCO_PLAN', 'TM_NRAF_L1_SOC_OTLT_DC_NDC_WK',
    'TM_NRAF_L1_SOC_OTLT_DC_NDC_MTH', 'TM_RX_L1_HCPPLNDC_NDC_WK', 'TM_RX_L1_HCPPLNDC_NDC_MTH',
    'TM_NRAFIC_L1_OTLT_SOC_DC_NDC_WK', 'TD_GEO_LOC', 'TXR_HCP_GEOLOC_PRIM',
    'TD_SALESFORCE_L1', 'TD_DATA_LOAD', 'TXR_HCP_SF_L1', 'TD_OTLT_SUBCAT',
    'TXR_OTLT_SUBCAT', 'TD_TIME_DT', 'TXR_MKTGPGM_GHEM_HCO_SUBTYPE',
    'TXR_MKTGPGM_CURR_PTAM_HCP_TGT', 'TXR_MKTGPGM_CURR_SAL_IDN_TGT', 'TXR_MKTGPGM_SUZ_HCP_SEGMENT',
    'TXR_MKTGPGM_PAIN_SOC_TGT', 'TD_IDN', 'TD_SOC', 'TD_HCP', 'TXR_SOC_IDN',
    'TXR_HCP_SOC', 'TD_SPECGRP', 'TXR_HCP_SPEC', 'TXR_NTILE_HCP_SUZ_QTRLY_STATIC_R52W',
    'TXR_NTILE_HCP_ANYPAIN_R52W', 'TXR_NTILE_HCP_SUZ_R52W'
);

-- STEP 3: The "Nuclear" Script (No 'INTO' clause used here)
EXECUTE IMMEDIATE $$
DECLARE
    db_name VARCHAR;
    sch_name VARCHAR;
    tbl_name VARCHAR;
    path VARCHAR;
    ddl_cmd VARCHAR;
    
    c1 CURSOR FOR SELECT DB_NAME, SCH_NAME, TBL_NAME FROM TBL_LOCATIONS;
BEGIN
    OPEN c1;
    FOR rec IN c1 DO
        db_name := rec.DB_NAME;
        sch_name := rec.SCH_NAME;
        tbl_name := rec.TBL_NAME;
        path := '"' || db_name || '"."' || sch_name || '"."' || tbl_name || '"';
        
        -- Build the command
        ddl_cmd := 'SELECT GET_DDL(\'TABLE\', \'' || path || '\')';
        
        BEGIN
            -- NEW METHOD: Run command without saving directly to variable
            EXECUTE IMMEDIATE :ddl_cmd;
            
            -- Capture the result from the query we just ran
            INSERT INTO FINAL_DDL_OUTPUT (TABLE_NAME, FULL_PATH, DDL_TEXT) 
            SELECT :tbl_name, :path, $1 FROM TABLE(RESULT_SCAN(LAST_QUERY_ID()));
            
        EXCEPTION
            WHEN OTHER THEN
                INSERT INTO FINAL_DDL_OUTPUT (TABLE_NAME, FULL_PATH, DDL_TEXT) 
                VALUES (:tbl_name, :path, 'ERROR: Could not retrieve DDL. Permission denied or table locked.');
        END;
    END FOR;
    CLOSE c1;
    RETURN 'Success. Run the SELECT below to see results.';
END;
$$;

-- STEP 4: View the results
SELECT * FROM FINAL_DDL_OUTPUT ORDER BY TABLE_NAME;
